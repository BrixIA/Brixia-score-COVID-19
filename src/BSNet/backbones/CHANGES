This code underwent to a refactory to make it compatible with tensorflow 2.0